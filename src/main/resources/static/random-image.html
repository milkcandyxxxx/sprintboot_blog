<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>éšæœºå›¾ç‰‡ - å¥‡æ€å¦™æƒ³</title>
    
    <!-- å¼•å…¥ç°æœ‰çš„æ ·å¼ -->
    <link rel="stylesheet" href="css/nes.css"/>
    <link rel="stylesheet" href="css/font.css"/>
    
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            transition: background 0.5s ease;
        }
        
        /* ä¸»æ ‡é¢˜ */
        .main-title {
            text-align: center;
            margin: 40px 0;
            color: white;
            text-shadow: 4px 4px 0px #000;
            font-size: 24px;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes titleGlow {
            from { text-shadow: 4px 4px 0px #000, 0 0 20px rgba(255, 255, 255, 0.5); }
            to { text-shadow: 4px 4px 0px #000, 0 0 30px rgba(255, 255, 255, 0.8); }
        }
        
        /* å†…å®¹å®¹å™¨ */
        .content-container {
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            background: #fff;
            border: 4px solid #000;
            box-shadow: 8px 8px 0 #000;
            padding: 30px;
            animation: slideInUp 0.6s ease-out;
        }
        
        /* é¡µé¢æè¿° */
        .page-description {
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
            line-height: 1.8;
            color: #333;
        }
        
        /* åˆ†ç±»é€‰æ‹©å™¨ */
        .category-selector {
            background: #a78bfa;
            border: 4px solid #000;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 4px 4px 0 #000;
        }
        
        .selector-header {
            font-size: 16px;
            font-weight: 900;
            margin-bottom: 15px;
            text-align: center;
            color: #000;
        }
        
        /* åˆ†ç±»ç½‘æ ¼ */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .category-button {
            padding: 12px 16px;
            background: #fff;
            border: 3px solid #000;
            box-shadow: 3px 3px 0 #000;
            font-family: inherit;
            font-size: 10px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .category-button:hover {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 #000;
            background: #f0f0f0;
        }
        
        .category-button:active {
            transform: translate(3px, 3px);
            box-shadow: 0 0 0 #000;
        }
        
        .category-button.active {
            background: #fbbf24;
            color: #000;
        }
        
        /* å›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸ */
        .image-display {
            text-align: center;
            margin: 20px 0;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border: 3px dashed #000;
            position: relative;
        }
        
        .image-display.loading {
            background: #e0e0e0;
        }
        
        .random-image {
            max-width: 100%;
            max-height: 600px;
            border: 3px solid #000;
            box-shadow: 5px 5px 0 #000;
            image-rendering: auto;
        }
        
        .placeholder-text {
            font-size: 14px;
            color: #666;
            text-align: center;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .loading-spinner.show {
            display: block;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #000;
            border-top: 4px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .control-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-button {
            padding: 12px 24px;
            background: #fff;
            border: 4px solid #000;
            box-shadow: 4px 4px 0 #000;
            font-family: inherit;
            font-size: 12px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .control-button:hover {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 #000;
            background: #f0f0f0;
        }
        
        .control-button:active {
            transform: translate(3px, 3px);
            box-shadow: 0 0 0 #000;
        }
        
        .control-button.primary {
            background: #fbbf24;
            color: #000;
        }
        
        /* è¿”å›æŒ‰é’® */
        .back-button {
            margin-top: 30px;
            padding: 12px 24px;
            background: #fff;
            border: 4px solid #000;
            box-shadow: 4px 4px 0 #000;
            font-family: inherit;
            font-size: 14px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .back-button:hover {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 #000;
            background: #f0f0f0;
        }
        
        .back-button:active {
            transform: translate(3px, 3px);
            box-shadow: 0 0 0 #000;
        }
        
        /* é”™è¯¯æç¤º */
        .error-message {
            color: #dc2626;
            font-size: 12px;
            margin-top: 10px;
            padding: 10px;
            background: #fee2e2;
            border: 2px solid #dc2626;
            display: none;
            text-align: center;
        }
        
        .error-message.show {
            display: block;
            animation: shake 0.5s ease-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .content-container {
                padding: 20px;
            }
            
            .category-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .main-title {
                font-size: 18px;
            }
            
            .control-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            body {
                padding: 10px;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* å›¾ç‰‡ä¿¡æ¯ */
        .image-info {
            background: #f0f0f0;
            border: 2px solid #000;
            padding: 10px;
            margin-top: 15px;
            font-size: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1 class="main-title">ğŸ¨ éšæœºå›¾ç‰‡ç”Ÿæˆå™¨ ğŸ–¼ï¸</h1>
    
    <div class="content-container">
        <div class="page-description">
            ğŸŒŸ è·å–éšæœºäºŒæ¬¡å…ƒã€é£æ™¯ã€åŠ¨æ¼«å›¾ç‰‡å£çº¸ï¼<br>
            é€‰æ‹©åˆ†ç±»ï¼Œç‚¹å‡»ç”Ÿæˆï¼Œå³å¯è·å¾—ç²¾ç¾éšæœºå›¾ç‰‡ï½
        </div>
        
        <!-- åˆ†ç±»é€‰æ‹©å™¨ -->
        <div class="category-selector">
            <div class="selector-header">ğŸ¯ é€‰æ‹©å›¾ç‰‡åˆ†ç±»</div>
            
            <!-- UapiProæœåŠ¡å™¨å›¾ç‰‡ -->
            <div style="margin-bottom: 15px;">
                <div style="font-size: 11px; font-weight: 900; margin-bottom: 8px; color: #555;">ğŸ–¥ï¸ UapiProæœåŠ¡å™¨å›¾ç‰‡</div>
                <div class="category-grid" id="uapiproCategories">
                    <button class="category-button" data-category="acg" data-type="">äºŒæ¬¡å…ƒåŠ¨æ¼«</button>
                    <button class="category-button" data-category="acg" data-type="pc">ç”µè„‘å£çº¸</button>
                    <button class="category-button" data-category="acg" data-type="mb">æ‰‹æœºå£çº¸</button>
                    <button class="category-button" data-category="furry" data-type="">ç¦ç‘</button>
                    <button class="category-button" data-category="furry" data-type="4k">4Kç¦ç‘</button>
                    <button class="category-button" data-category="bq" data-type="">è¡¨æƒ…åŒ…</button>
                    <button class="category-button" data-category="4k" data-type="">4Kå£çº¸</button>
                </div>
            </div>
            
            <!-- å¤–éƒ¨å›¾åºŠç²¾é€‰å›¾ç‰‡ -->
            <div style="margin-bottom: 15px;">
                <div style="font-size: 11px; font-weight: 900; margin-bottom: 8px; color: #555;">ğŸŒ å¤–éƒ¨å›¾åºŠç²¾é€‰</div>
                <div class="category-grid" id="externalCategories">
                    <button class="category-button" data-category="general_anime" data-type="">åŠ¨æ¼«å›¾</button>
                    <button class="category-button" data-category="landscape" data-type="">é£æ™¯å›¾</button>
                    <button class="category-button" data-category="mobile_wallpaper" data-type="">æ‰‹æœºå£çº¸</button>
                    <button class="category-button" data-category="pc_wallpaper" data-type="">ç”µè„‘å£çº¸</button>
                    <button class="category-button" data-category="ai_drawing" data-type="">AIç»˜ç”»</button>
                </div>
            </div>
            
            <!-- æ··åˆåˆ†ç±» -->
            <div>
                <div style="font-size: 11px; font-weight: 900; margin-bottom: 8px; color: #555;">ğŸ­ æ··åˆåˆ†ç±»</div>
                <div class="category-grid" id="mixedCategories">
                    <button class="category-button" data-category="anime" data-type="">æ··åˆåŠ¨æ¼«</button>
                    <button class="category-button active" data-category="" data-type="">å…¨å±€éšæœº</button>
                </div>
            </div>
        </div>
        
        <!-- å›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸ -->
        <div class="image-display" id="imageDisplay">
            <div class="placeholder-text" id="placeholderText">
                ğŸ¨ é€‰æ‹©åˆ†ç±»å¹¶ç‚¹å‡»ç”ŸæˆæŒ‰é’®<br>è·å–éšæœºç²¾ç¾å›¾ç‰‡ï½
            </div>
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
            </div>
            <img class="random-image" id="randomImage" style="display: none;" alt="éšæœºå›¾ç‰‡">
        </div>
        
        <!-- å›¾ç‰‡ä¿¡æ¯ -->
        <div class="image-info" id="imageInfo" style="display: none;">
            <div>ğŸ“Š åˆ†ç±»: <span id="currentCategory">-</span> | ğŸ”— ç›´æ¥é“¾æ¥: <a href="#" id="directLink" target="_blank">ç‚¹å‡»æŸ¥çœ‹</a></div>
        </div>
        
        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="control-buttons">
            <button class="control-button primary" id="generateBtn" onclick="generateRandomImage()">ğŸ² ç”Ÿæˆéšæœºå›¾ç‰‡</button>
            <button class="control-button" onclick="downloadImage()">ğŸ’¾ ä¸‹è½½å›¾ç‰‡</button>
            <button class="control-button" onclick="openImageInNewTab()">ğŸ”— æ–°æ ‡ç­¾é¡µæ‰“å¼€</button>
            <button class="control-button" onclick="refreshImage()">ğŸ”„ åˆ·æ–°</button>
        </div>
        
        <div id="errorMessage" class="error-message"></div>
    </div>
    
    <button class="back-button" onclick="goBack()">è¿”å›å¥‡æ€å¦™æƒ³</button>
    
    <script>
        // å½“å‰é€‰ä¸­çš„åˆ†ç±»
        let currentCategory = '';
        let currentType = '';
        let currentImageUrl = '';
        
        // åˆ†ç±»ä¸­æ–‡åç§°æ˜ å°„
        const categoryNames = {
            '': 'å…¨å±€éšæœº',
            'acg': 'äºŒæ¬¡å…ƒåŠ¨æ¼«',
            'furry': 'ç¦ç‘',
            'bq': 'è¡¨æƒ…åŒ…',
            '4k': '4Kå£çº¸',
            'general_anime': 'åŠ¨æ¼«å›¾',
            'landscape': 'é£æ™¯å›¾',
            'mobile_wallpaper': 'æ‰‹æœºå£çº¸',
            'pc_wallpaper': 'ç”µè„‘å£çº¸',
            'ai_drawing': 'AIç»˜ç”»',
            'anime': 'æ··åˆåŠ¨æ¼«'
        };
        
        // åˆå§‹åŒ–åˆ†ç±»æŒ‰é’®äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.category-button');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    buttons.forEach(btn => btn.classList.remove('active'));
                    // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                    this.classList.add('active');
                    
                    // æ›´æ–°å½“å‰é€‰ä¸­çš„åˆ†ç±»
                    currentCategory = this.dataset.category;
                    currentType = this.dataset.type;
                });
            });
        });
        
        // ç”Ÿæˆéšæœºå›¾ç‰‡
        async function generateRandomImage() {
            const imageDisplay = document.getElementById('imageDisplay');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const placeholderText = document.getElementById('placeholderText');
            const randomImage = document.getElementById('randomImage');
            const generateBtn = document.getElementById('generateBtn');
            const errorMessage = document.getElementById('errorMessage');
            const imageInfo = document.getElementById('imageInfo');
            
            // éšè—é”™è¯¯ä¿¡æ¯
            errorMessage.classList.remove('show');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            imageDisplay.classList.add('loading');
            loadingSpinner.classList.add('show');
            placeholderText.style.display = 'none';
            randomImage.style.display = 'none';
            imageInfo.style.display = 'none';
            
            // ç¦ç”¨ç”ŸæˆæŒ‰é’®
            generateBtn.disabled = true;
            generateBtn.innerHTML = 'ğŸ² åŠ è½½ä¸­...';
            
            try {
                // æ„å»ºAPI URL
                let apiUrl = 'https://uapis.cn/api/v1/random/image';
                const params = new URLSearchParams();
                
                if (currentCategory) {
                    params.append('category', currentCategory);
                }
                if (currentType) {
                    params.append('type', currentType);
                }
                
                if (params.toString()) {
                    apiUrl += '?' + params.toString();
                }
                
                // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
                apiUrl += (apiUrl.includes('?') ? '&' : '?') + 't=' + Date.now();
                
                // é¢„åŠ è½½å›¾ç‰‡
                const img = new Image();
                img.onload = function() {
                    // éšè—åŠ è½½çŠ¶æ€
                    loadingSpinner.classList.remove('show');
                    imageDisplay.classList.remove('loading');
                    
                    // æ˜¾ç¤ºå›¾ç‰‡
                    randomImage.src = apiUrl;
                    randomImage.style.display = 'block';
                    currentImageUrl = apiUrl;
                    
                    // æ˜¾ç¤ºå›¾ç‰‡ä¿¡æ¯
                    document.getElementById('currentCategory').textContent = categoryNames[currentCategory] || 'å…¨å±€éšæœº';
                    document.getElementById('directLink').href = apiUrl;
                    imageInfo.style.display = 'block';
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = 'ğŸ² ç”Ÿæˆéšæœºå›¾ç‰‡';
                };
                
                img.onerror = function() {
                    throw new Error('å›¾ç‰‡åŠ è½½å¤±è´¥');
                };
                
                img.src = apiUrl;
                
            } catch (error) {
                console.error('ç”Ÿæˆå¤±è´¥:', error);
                showError('ç”Ÿæˆå¤±è´¥: ' + error.message);
                
                // æ¢å¤çŠ¶æ€
                loadingSpinner.classList.remove('show');
                imageDisplay.classList.remove('loading');
                placeholderText.style.display = 'block';
                generateBtn.disabled = false;
                generateBtn.innerHTML = 'ğŸ² ç”Ÿæˆéšæœºå›¾ç‰‡';
            }
        }
        
        // ä¸‹è½½å›¾ç‰‡
        function downloadImage() {
            if (!currentImageUrl) {
                showError('è¯·å…ˆç”Ÿæˆä¸€å¼ å›¾ç‰‡ï¼');
                return;
            }
            
            const link = document.createElement('a');
            link.href = currentImageUrl;
            link.download = 'random-image-' + Date.now() + '.jpg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€å›¾ç‰‡
        function openImageInNewTab() {
            if (!currentImageUrl) {
                showError('è¯·å…ˆç”Ÿæˆä¸€å¼ å›¾ç‰‡ï¼');
                return;
            }
            
            window.open(currentImageUrl, '_blank');
        }
        
        // åˆ·æ–°å½“å‰å›¾ç‰‡
        function refreshImage() {
            if (!currentImageUrl) {
                showError('è¯·å…ˆç”Ÿæˆä¸€å¼ å›¾ç‰‡ï¼');
                return;
            }
            
            generateRandomImage();
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                errorMessage.classList.remove('show');
            }, 3000);
        }
        
        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (document.referrer) {
                window.history.back();
            } else {
                window.location.href = 'fun.html';
            }
        }
        
        // é¡µé¢åŠ è½½åŠ¨ç”»
        window.addEventListener('load', function() {
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.5s ease';
            
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
        });
        
        // æ·»åŠ é”®ç›˜æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.ctrlKey && !e.altKey) {
                generateRandomImage();
            } else if (e.key === 'r' && e.ctrlKey) {
                e.preventDefault();
                refreshImage();
            } else if (e.key === 'Escape') {
                goBack();
            }
        });
        
        // å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†
        document.getElementById('randomImage').addEventListener('error', function() {
            showError('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            this.style.display = 'none';
            document.getElementById('loadingSpinner').classList.remove('show');
            document.getElementById('imageDisplay').classList.remove('loading');
            document.getElementById('placeholderText').style.display = 'block';
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('generateBtn').innerHTML = 'ğŸ² ç”Ÿæˆéšæœºå›¾ç‰‡';
        });
    </script>
    
    <script src="js/loader.js"></script>
    <iframe
            src="fixed-action-buttons.html"
            style="position: fixed; bottom: 0; right: 0; border: none; width: auto; height: auto; z-index: 9999;"
            frameborder="0"
            scrolling="no"
    ></iframe>
</body>
</html>